# c4rv -- c 語言轉 bytecode (*.bc4) 的工具鏈

## 建置執行

```
user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/_project/c4ext (master)
$ make
gcc -D__C4__ -m32 -Wall -std=gnu99 -o c4 c4.c bc.c
gcc -m32 -Wall -std=gnu99 -o vm4 vm4.c bc.c c4.c
gcc -m32 -Wall -std=gnu99 -o bc4 bc4.c bc.c c4.c
gcc -m32 -Wall -std=gnu99 -o bc2c bc2c.c c4.c bc.c


user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/_project/c4ext (master)
$ ./c4 c4.c test/sum.c
i=1 s=0
i=1 s=0
i=2 s=1
i=3 s=3
i=4 s=6
i=5 s=10
i=6 s=15
i=7 s=21
i=8 s=28
i=9 s=36
i=10 s=45
sum(10)=55
exit(11) cycle = 412
exit(0) cycle = 142582

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/project/c4rv/c4 (master)
$ ./c4 -o test/sum.bc test/sum.c
---------bc_save()-------------
header: entry=56

          Size      VMA      LMA   Offset
code: 00000124 00AF0050 00AF0050 00000040
data: 00000000 00B30058 00B30058 00000164
relo: 00000000 00BF0070 00BF0070 00000164
stab: 0000000C 00BB0068 00BB0068 00000164

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/project/c4rv/c4 (master)
$ ./bc4 test/sum.bc
---------bc_dump()-------------
header: entry=56

          Size      VMA      LMA   Offset  
code: 00000124 00AF0050 006F0088 00000040
data: 00000000 00B30058 006F01AC 00000164
relo: 00000000 00BF0070 006F01AC 00000164
stab: 0000000C 00BB0068 006F01AC 00000164
0000:00000008 ENT 2
0001:00000000 LEA -1
0002:0000000F PSH
0003:00000001 IMM 0
0004:0000000D SI
0005:00000000 LEA -2
0006:0000000F PSH
0007:00000001 IMM 1
0008:0000000D SI
0009:00000000 LEA -2
000A:0000000B LI
000B:0000000F PSH
000C:00000000 LEA 2
000D:0000000B LI
000E:00000017 LE
000F:00000006 BZ
0010:0000001C SUB
0011:00000000 LEA -1
0012:0000000F PSH
0013:00000000 LEA -1
0014:0000000B LI
0015:0000000F PSH
0016:00000000 LEA -2
0017:0000000B LI
0018:0000001B ADD
0019:0000000D SI
001A:00000000 LEA -2
001B:0000000F PSH
001C:0000000B LI
001D:0000000F PSH
001E:00000001 IMM 1
001F:0000001B ADD
0020:0000000D SI
0021:0000000F PSH
0022:00000001 IMM 1
0023:0000001C SUB
0024:00000004 JMP -36
0025:00000000 LEA -1
0026:0000000B LI
0027:0000000A LEV
0028:0000000A LEV
0029:00000008 ENT 0
002A:00000003 STR 0
002B:0000000F PSH
002C:00000001 IMM 10
002D:0000000F PSH
002E:00000005 JSR -65
002F:00000009 ADJ 1
0030:0000000F PSH
0031:00000024 PRTF
0032:00000009 ADJ 2
0033:0000000A LEV

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/project/c4rv/c4 (master)
$ ./vm4 test/sum.bc
sum(10)=55
exit(11) cycle = 302

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/_project/c4ext (master)
$ ./bc4 test/sum.bc
---------bc_dump()-------------
header: entry=84

          Size      VMA      LMA   Offset  
code: 00000194 00660050 00D700B0 00000040
data: 00000000 006A0058 00D70244 000001D4
relo: 00000000 00E80068 00D70244 000001D4
stab: 00000024 00E40060 00D70244 000001D4
syms: 00000095 00E00058 00D70268 000001F8
string table:i=%d s=%d\n  i=%d s=%d\n  sum(10)=%d\n 
symbol string table:char else enum if int return sizeof while open read write close printf sprintf sscanf gets malloc free memset memcmp memcpy exit void main sum n s i 
0000:00000008 ENT 2
0001:00000001 LVAR -1
0002:0000000F PSH
0003:00000000 IMM 0
0004:0000000D SI
0005:00000001 LVAR -2
0006:0000000F PSH
0007:00000000 IMM 1
0008:0000000D SI
0009:00000003 STR 0
000A:0000000F PSH
000B:00000001 LVAR -2
000C:0000000B LI
000D:0000000F PSH
000E:00000001 LVAR -1
000F:0000000B LI
0010:0000000F PSH
0011:00000024 PRTF
0012:00000009 ADJ 3
0013:00000001 LVAR -2
0014:0000000B LI
0015:0000000F PSH
0016:00000001 LVAR 2
0017:0000000B LI
0018:00000017 LE
0019:00000006 BZ 42
001A:00000003 STR 12
001B:0000000F PSH
001C:00000001 LVAR -2
001D:0000000B LI
001E:0000000F PSH
001F:00000001 LVAR -1
0020:0000000B LI
0021:0000000F PSH
0022:00000024 PRTF
0023:00000009 ADJ 3
0024:00000001 LVAR -1
0025:0000000F PSH
0026:00000001 LVAR -1
0027:0000000B LI
0028:0000000F PSH
0029:00000001 LVAR -2
002A:0000000B LI
002B:0000001B ADD
002C:0000000D SI
002D:00000001 LVAR -2
002E:0000000F PSH
002F:0000000B LI
0030:0000000F PSH
0031:00000000 IMM 1
0032:0000001B ADD
0033:0000000D SI
0034:0000000F PSH
0035:00000000 IMM 1
0036:0000001C SUB
0037:00000004 JMP -50
0038:00000001 LVAR -1
0039:0000000B LI
003A:0000000A LEV
003B:0000000A LEV
003C:00000008 ENT 0
003D:00000003 STR 24
003E:0000000F PSH
003F:00000000 IMM 10
0040:0000000F PSH
0041:00000005 JSR -93
0042:00000009 ADJ 1
0043:0000000F PSH
0044:00000024 PRTF
0045:00000009 ADJ 2
0046:0000000A LEV

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/_project/c4ext (master)
$ ./vm4 test/sum.bc
i=1 s=0
i=1 s=0
i=2 s=1
i=3 s=3
i=4 s=6
i=5 s=10
i=6 s=15
i=7 s=21
i=8 s=28
i=9 s=36
i=10 s=45
sum(10)=55
exit(11) cycle = 412

user@DESKTOP-96FRN6B MINGW64 /d/ccc/ccc109/sp/_project/c4ext (master)
$ ./cjit.sh test/sum
bc_save: symstab=00B20058 symstabp=00B200ED size=149
---------bc_save()-------------
header: entry=84

          Size      VMA      LMA   Offset  
code: 00000194 00660050 00660050 00000040
data: 00000000 006A0058 006A0058 000001D4
relo: 00000000 00BA0068 00BA0068 000001D4
stab: 00000024 00B60060 00B60060 000001D4
syms: 00000095 00B20058 00B20058 000001F8
i=1 s=0
i=1 s=0
i=2 s=1
i=3 s=3
i=4 s=6
i=5 s=10
i=6 s=15
i=7 s=21
i=8 s=28
i=9 s=36
i=10 s=45
sum(10)=55
```
